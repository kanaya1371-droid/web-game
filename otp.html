<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Verifikasi OTP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="assets/style.css" />
</head>
<body>

<div class="card">
  <h2>Verifikasi OTP</h2>
  <p>Masukkan kode OTP dari Admin</p>

  <input type="text" id="otp" placeholder="Kode OTP" />

  <button id="btnVerifikasi">Verifikasi</button>

  <button id="btnMintaOTP" style="margin-top:10px;">
    Minta OTP ke Admin
  </button>
</div>

<script>
const API = "https://obel88.up.railway.app";
const ADMIN_WA = "628XXXXXXXXXX"; // GANTI NOMOR ADMIN

const username = localStorage.getItem("otp_user");

if (!username) {
  alert("Data pendaftaran tidak ditemukan");
  window.location.href = "register.html";
}

// VERIFIKASI OTP
document.getElementById("btnVerifikasi").addEventListener("click", async () => {
  const otp = document.getElementById("otp").value.trim();

  if (!otp) {
    alert("Masukkan OTP");
    return;
  }

  try {
    const res = await fetch(API + "/verify-otp", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        username,
        otp
      })
    });

    const data = await res.json();

    if (data.success) {
      localStorage.removeItem("otp_user");
      alert("Verifikasi berhasil");
      window.location.href = "login.html";
    } else {
      alert(data.message || "OTP salah");
    }

  } catch (err) {
    alert("Server tidak merespon");
    console.error(err);
  }
});

// MINTA OTP KE ADMIN VIA WA
document.getElementById("btnMintaOTP").addEventListener("click", () => {
  const pesan = `Halo Admin, saya minta OTP.\nUsername: ${username}`;
  const url = `https://wa.me/${ADMIN_WA}?text=${encodeURIComponent(pesan)}`;
  window.open(url, "_blank");
});
</script>

</body>
</html>
